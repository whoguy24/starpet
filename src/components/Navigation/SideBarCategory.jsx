import { SimpleTreeView } from "@mui/x-tree-view/SimpleTreeView";
import { TreeItem } from "@mui/x-tree-view/TreeItem";
import { useState, useEffect } from "react";
import { useNavigate, useLocation } from "react-router-dom";
import styles from "./SideBarCategory.module.css";
import Divider from "@mui/material/Divider";
import { getPage } from "../../db/pages";
import Typography from "@mui/material/Typography";
import Box from "@mui/material/Box";
import { SvgIcon } from "@mui/material";

function SideBarCategory({ category }) {
    const location = useLocation();
    const navigate = useNavigate();

    const [selectedItems, setSelectedItems] = useState([]);
    const [expandedItems, setExpandedItems] = useState([]);

    function handleSelectedItemsChange(event, itemId) {
        const selectedItem = getPage({ id: itemId });
        if (location.pathname != selectedItem.url) {
            navigate(selectedItem.url);
        } else if (location.pathname === selectedItem.url && selectedItem.children.length > 0) {
            if (expandedItems.includes(selectedItem.id)) {
                const updatedExpandedItems = expandedItems.filter((item) => item !== selectedItem.id);
                setExpandedItems(updatedExpandedItems);
            } else {
                const updatedExpandedItems = [...expandedItems, selectedItem.id];
                setExpandedItems(updatedExpandedItems);
            }
        }
    }

    useEffect(() => {
        const routeArray = location.pathname.split("/").filter(Boolean);
        const newItemIds = routeArray.filter((itemId) => !expandedItems.includes(itemId));
        const updatedExpandedItems = [...expandedItems, ...newItemIds];
        setExpandedItems(updatedExpandedItems);
        const activePage = getPage({ url: location.pathname });
        setSelectedItems([activePage.id]);
    }, [location.pathname]);

    function DynamicIcon({ pathData }) {
        return (
            <SvgIcon viewBox="0 0 24 24">
                <path d={pathData} fill="currentColor" />
            </SvgIcon>
        );
    }

    return (
        <div className={styles.container}>
            <Typography variant="overline" sx={{ marginLeft: 2 }}>
                {category.label}
            </Typography>
            <Divider />
            <SimpleTreeView
                selectedItems={selectedItems}
                expandedItems={expandedItems}
                onSelectedItemsChange={handleSelectedItemsChange}
                sx={(theme) => ({
                    "& .MuiTreeItem-content": {
                        height: 40,
                        borderRadius: 0,
                    },
                    "& .MuiTreeItem-content.Mui-selected.Mui-focused": {
                        backgroundColor: theme.palette.primary.main,
                        color: theme.palette.primary.contrastText,
                    },
                    "& .MuiTreeItem-content.Mui-selected:not(.Mui-focused)": {
                        backgroundColor: theme.palette.primary.main,
                        color: theme.palette.primary.contrastText,
                    },
                    "& .MuiTreeItem-content.Mui-focused": {
                        backgroundColor: theme.palette.primary.main,
                    },
                    "& .MuiTreeItem-content:hover": {
                        backgroundColor: theme.palette.secondary.light,
                    },
                    "& .MuiTreeItem-content.Mui-focused img": {
                        color: "red",
                    },
                })}
            >
                {category.children.map((page) => (
                    <TreeItem
                        key={page.id}
                        itemId={page.id}
                        label={
                            <Box display="flex" flexDirection="row" alignItems="center" sx={{ gap: 1 }}>
                                <img src={page.iconPath} alt="icon" className={styles.menuIcon} />
                                {/* <DynamicIcon
                                    pathData="M 1.13993 3.26629 C 1.74074 3.49075 2.20425 3.68932 2.20889 3.69133 C 2.21496 3.69396 2.22208 3.69668 2.2283 3.69883 C 2.28524 3.71874 3.6224 4.20228 3.60366 5.64149 C 3.57541 7.80966 4.12119 9.20507 5.27071 9.90437 C 5.32354 9.98651 5.38105 10.0682 5.44454 10.149 C 5.79863 10.6016 6.03049 11.1375 6.11793 11.7052 L 6.51121 14.2357 C 6.57505 14.6445 6.56282 15.0616 6.47511 15.466 L 6.268 16.4237 C 6.25931 16.4647 6.23848 16.5021 6.20822 16.5311 C 6.17795 16.5601 6.13964 16.5794 6.09828 16.5864 L 6.07944 16.5893 C 5.91591 16.6161 5.76844 16.7033 5.66633 16.8336 C 5.56422 16.964 5.51496 17.128 5.52834 17.293 C 5.54172 17.4579 5.61676 17.6119 5.73854 17.7241 C 5.86032 17.8364 6.01992 17.8987 6.18563 17.8988 H 7.48402 C 7.64635 17.8991 7.80477 17.849 7.93728 17.7553 C 8.06979 17.6617 8.16982 17.5291 8.22348 17.376 L 8.5851 17.4059 C 8.68475 17.4209 8.7853 17.429 8.88606 17.4302 C 9.09675 17.4302 9.30104 17.3841 9.42482 17.2216 C 9.60439 16.9858 9.48166 16.7052 9.40044 16.5195 C 9.3924 16.5013 9.38461 16.4834 9.3773 16.466 C 9.12621 15.8706 9.2048 15.2445 9.31357 14.378 C 9.42076 13.5244 9.55209 12.4769 9.44222 11.0226 C 9.62112 11.0371 9.81599 11.0464 10.0255 11.0464 C 10.0808 11.0464 10.1371 11.0458 10.1944 11.0445 C 11.0475 11.0249 12.2537 10.8425 13.5779 10.1713 C 14.1892 10.935 14.8643 11.6454 15.596 12.295 C 16.3213 12.9468 17.1692 14.0814 17.3168 15.0321 L 17.3324 15.1316 C 17.3719 15.3813 17.4166 15.6643 17.4086 15.8861 C 17.4059 15.9318 17.3893 15.9755 17.361 16.0115 C 17.3328 16.0475 17.2943 16.0741 17.2506 16.0876 C 16.9434 16.1848 16.6499 16.3207 16.3772 16.492 C 16.2597 16.5704 16.1705 16.6844 16.1228 16.8173 C 16.075 16.9502 16.0712 17.0948 16.112 17.23 C 16.1527 17.3651 16.2359 17.4837 16.3491 17.5681 C 16.4623 17.6525 16.5997 17.6984 16.7411 17.699 C 16.7523 17.699 16.7637 17.6987 16.7751 17.6982 L 17.5162 17.6647 C 17.573 17.7667 17.6561 17.8516 17.7569 17.9106 C 17.8578 17.9696 17.9726 18.0004 18.0894 18 L 19.5337 17.9288 C 19.6505 17.9231 19.7646 17.8917 19.8678 17.8368 C 19.971 17.7819 20.0608 17.7049 20.1308 17.6114 C 20.2008 17.5178 20.2493 17.4099 20.2727 17.2955 C 20.2961 17.181 20.2939 17.0628 20.2663 16.9493 L 20.1058 16.2915 C 20.0844 16.204 20.0758 16.114 20.0802 16.024 L 20.216 13.2374 C 20.2271 13.0032 20.1838 12.7697 20.0894 12.5551 C 19.2212 10.5879 19.308 10.1921 19.4516 9.53626 C 19.5534 9.07159 19.6801 8.4933 19.5702 7.30248 C 19.5413 6.93206 19.4546 6.56843 19.3133 6.22474 C 19.2847 6.16143 19.2821 6.08941 19.3061 6.0242 C 19.3301 5.95899 19.3788 5.90581 19.4417 5.87612 C 23.9043 3.8197 23.9981 1.20477 24 1.09445 C 24.001 1.03054 23.9806 0.968138 23.942 0.917151 C 23.9034 0.866164 23.8489 0.829523 23.7871 0.813055 C 23.7252 0.796586 23.6597 0.801234 23.6008 0.826261 C 23.5419 0.851288 23.4931 0.895257 23.4622 0.951176 C 23.0725 1.65473 21.7638 3.42236 18.0372 4.63845 C 17.7843 4.71932 17.5139 4.72817 17.2562 4.664 C 16.0966 4.38223 14.5831 4.41566 12.6669 4.45826 C 12.2608 4.46724 11.8409 4.4765 11.4062 4.483 C 9.56165 4.5106 8.26799 4.22315 7.44907 3.60427 C 6.75226 3.07756 6.48032 2.37534 6.21737 1.69623 C 6.1754 1.58787 6.13395 1.4809 6.09149 1.37626 C 5.73364 0.494572 4.79004 -0.00797519 3.50126 0.0000957431 C 3.21012 0.00187045 2.92641 0.092009 2.68774 0.258557 L 2.41834 0.44543 C 2.28801 0.535693 2.13679 0.591281 1.97898 0.606944 L 0.42122 0.760578 C 0.353707 0.767189 0.288447 0.788421 0.229986 0.822796 C 0.171525 0.85717 0.121267 0.90386 0.0827127 0.959616 C 0.0441581 1.01537 0.0182333 1.07885 0.00674363 1.14564 C -0.00474607 1.21242 -0.00152451 1.2809 0.016184 1.34632 C 0.222049 2.10752 0.584105 3.05845 1.13993 3.26629 Z M 8.24165 16.8019 C 8.23208 16.7108 8.22252 16.6182 8.21296 16.527 C 8.1827 16.2405 8.15411 15.9696 8.14651 15.8252 C 8.12882 15.4869 8.28448 13.9705 8.57363 11.6649 C 8.60515 11.4115 8.61658 11.156 8.60781 10.9008 C 8.68283 10.9172 8.76764 10.9339 8.8612 10.9499 C 8.98273 12.4087 8.85135 13.4572 8.74464 14.3069 C 8.62923 15.2259 8.53811 15.9518 8.84887 16.6887 C 8.85714 16.7083 8.86598 16.7286 8.87497 16.7492 C 8.88735 16.7775 8.90533 16.8185 8.91977 16.8563 L 8.24165 16.8019 Z M 17.4779 17.0929 L 16.7482 17.1257 C 16.7287 17.1278 16.7092 17.1228 16.6932 17.1115 C 16.6771 17.1003 16.6657 17.0837 16.6611 17.0647 C 16.654 17.0478 16.6532 17.0289 16.6591 17.0116 C 16.665 16.9942 16.677 16.9796 16.693 16.9705 C 16.9233 16.8272 17.1708 16.7134 17.4297 16.632 C 17.5847 16.5817 17.7207 16.4853 17.8194 16.3557 C 17.9181 16.2261 17.9749 16.0695 17.9821 15.9069 C 17.9922 15.6295 17.9428 15.3173 17.8993 15.042 L 17.8839 14.9441 C 17.7139 13.8489 16.8051 12.6104 15.9798 11.8685 C 15.2966 11.2615 14.6638 10.6 14.0878 9.89067 C 14.213 9.8164 14.3389 9.73813 14.4654 9.65451 C 15.022 10.4928 15.8477 11.4873 17.0739 12.5893 C 17.8016 13.2356 18.2844 14.1124 18.4413 15.0724 C 18.503 15.4698 18.4711 16.123 18.3854 16.4105 C 18.1094 16.513 17.8553 16.6665 17.6362 16.863 C 17.5676 16.9275 17.5136 17.0059 17.4779 17.0929 Z M 2.03534 1.1775 C 2.29045 1.15219 2.53489 1.06231 2.74554 0.916362 L 3.01495 0.729536 C 3.15843 0.629064 3.3291 0.574534 3.50432 0.57318 C 4.93012 0.564536 5.4039 1.20773 5.55962 1.59131 C 5.60097 1.69313 5.64128 1.79724 5.6821 1.90269 C 5.76185 2.10866 5.84465 2.32185 5.94065 2.53571 C 5.93506 3.14055 5.5306 3.68312 5.18556 4.03561 C 5.15591 4.06628 5.11933 4.08941 5.07889 4.10306 C 5.03845 4.1167 4.99533 4.12048 4.95313 4.11406 C 4.91093 4.10763 4.87088 4.09121 4.83634 4.06615 C 4.80181 4.0411 4.77378 4.00814 4.75461 3.97004 C 4.57012 3.60709 4.55716 3.24189 4.71603 2.88414 C 5.00107 2.24238 4.9327 1.75679 4.82518 1.46246 C 4.81226 1.42711 4.79251 1.39465 4.76703 1.36693 C 4.74156 1.33921 4.71087 1.31677 4.67671 1.3009 C 4.64256 1.28502 4.60561 1.27602 4.56797 1.27441 C 4.53033 1.2728 4.49275 1.27862 4.45736 1.29152 C 4.42197 1.30442 4.38948 1.32415 4.36172 1.3496 C 4.33397 1.37505 4.31151 1.4057 4.29562 1.43982 C 4.27973 1.47394 4.27072 1.51085 4.26911 1.54845 C 4.2675 1.58604 4.27332 1.62359 4.28623 1.65894 C 4.38997 1.94285 4.35794 2.27686 4.19166 2.65176 C 3.96266 3.16753 3.98044 3.71292 4.24306 4.22955 C 4.30292 4.34918 4.39078 4.45262 4.49918 4.53111 C 4.60758 4.6096 4.73333 4.66082 4.86577 4.68042 C 4.90902 4.68709 4.95272 4.69044 4.99648 4.69045 C 5.10834 4.69047 5.21906 4.66796 5.32202 4.62429 C 5.42499 4.58061 5.51809 4.51666 5.59576 4.43624 C 5.87415 4.15185 6.18453 3.76034 6.36424 3.29719 C 7.03409 4.25396 8.27612 5.0578 11.1715 5.05775 C 11.2511 5.05775 11.3324 5.05708 11.4146 5.05589 C 11.8514 5.04935 12.2724 5.04004 12.6795 5.03106 C 14.4794 4.99132 16.034 4.95689 17.1206 5.2207 C 17.4819 5.31016 17.8611 5.29711 18.2154 5.18302 C 19.1843 4.86687 21.1817 4.10371 22.6661 2.7955 C 21.7532 4.00629 20.3005 4.84906 19.2015 5.35566 C 19.0023 5.44728 18.8471 5.61343 18.7695 5.81829 C 18.6918 6.02315 18.6978 6.25031 18.7862 6.45078 C 18.9038 6.73935 18.9756 7.04445 18.9991 7.3551 C 19.1008 8.45753 18.9848 8.98777 18.8913 9.41381 C 18.7136 10.2248 18.6629 10.7432 19.5646 12.7864 C 19.6231 12.9195 19.65 13.0644 19.6431 13.2096 L 19.5074 15.9962 C 19.5002 16.1411 19.5141 16.2863 19.5485 16.4273 L 19.709 17.0851 C 19.7166 17.1166 19.7172 17.1494 19.7107 17.1812 C 19.7041 17.2129 19.6906 17.2428 19.6711 17.2688 C 19.6517 17.2947 19.6267 17.3161 19.598 17.3312 C 19.5693 17.3464 19.5376 17.3551 19.5052 17.3566 L 18.0951 17.4269 C 18.0771 17.4285 18.0591 17.4242 18.0439 17.4145 C 18.0286 17.4048 18.017 17.3904 18.0108 17.3735 C 18.003 17.3581 18.0006 17.3406 18.004 17.3238 C 18.0074 17.307 18.0164 17.2917 18.0295 17.2806 C 18.2983 17.0279 18.6775 16.9156 18.6805 16.9147 C 18.7173 16.9042 18.7515 16.8865 18.7813 16.8627 C 18.8111 16.8388 18.8359 16.8092 18.8541 16.7756 C 19.0592 16.3973 19.0824 15.4623 19.0083 14.9847 C 18.8311 13.8943 18.2836 12.8981 17.4578 12.1634 C 16.4676 11.2736 15.1284 9.88933 14.3708 8.34721 C 13.924 7.43777 13.8906 6.8943 13.8899 6.88006 C 13.8871 6.80412 13.8542 6.73239 13.7985 6.68066 C 13.7427 6.62893 13.6687 6.60143 13.5927 6.60422 C 13.5167 6.60701 13.4449 6.63985 13.3931 6.69552 C 13.3413 6.75119 13.3138 6.82513 13.3166 6.90108 C 13.3185 6.95901 13.3617 7.80507 14.1613 9.16858 C 12.616 10.1934 11.1685 10.4448 10.2083 10.4706 C 9.65017 10.4894 9.0921 10.431 8.55001 10.2969 C 8.5011 9.9864 8.42222 9.68137 8.31446 9.38607 L 7.99103 8.50256 C 7.9784 8.46682 7.9588 8.43393 7.93336 8.40581 C 7.90792 8.37768 7.87715 8.35488 7.84282 8.33872 C 7.8085 8.32256 7.77131 8.31336 7.7334 8.31166 C 7.69549 8.30996 7.65762 8.31579 7.62199 8.32881 C 7.58635 8.34183 7.55366 8.36179 7.52579 8.38752 C 7.49793 8.41325 7.47546 8.44425 7.45967 8.47872 C 7.44389 8.51319 7.43511 8.55044 7.43384 8.58833 C 7.43257 8.62621 7.43883 8.66397 7.45227 8.69942 L 7.77565 9.58292 C 8.01027 10.2255 8.08864 10.9147 8.00432 11.5935 C 7.79396 13.2715 7.54837 15.373 7.57361 15.855 C 7.58193 16.0144 7.61133 16.2925 7.64241 16.5869 C 7.66048 16.7583 7.67918 16.9352 7.69438 17.0953 C 7.69712 17.1246 7.69372 17.154 7.68439 17.1819 C 7.67506 17.2097 7.66001 17.2353 7.6402 17.2569 C 7.62039 17.2786 7.59627 17.2959 7.56937 17.3077 C 7.54247 17.3195 7.5134 17.3256 7.48402 17.3255 H 6.18563 C 6.16409 17.3255 6.14336 17.3173 6.12752 17.3028 C 6.11169 17.2882 6.1019 17.2682 6.1001 17.2468 C 6.0983 17.2253 6.10461 17.204 6.11779 17.187 C 6.13097 17.1699 6.15006 17.1585 6.17128 17.1548 L 6.18692 17.1524 C 6.34257 17.127 6.48699 17.0555 6.60141 16.9471 C 6.71584 16.8387 6.79498 16.6984 6.82856 16.5445 L 7.03567 15.5867 C 7.13826 15.1137 7.15261 14.6258 7.07798 14.1476 L 6.68485 11.6172 C 6.58225 10.9523 6.31054 10.3248 5.89571 9.79487 C 5.01833 8.67893 5.44545 7.28968 5.44966 7.2765 C 5.47305 7.20418 5.46673 7.12554 5.43208 7.05788 C 5.39743 6.99022 5.3373 6.93908 5.2649 6.91572 C 5.19251 6.89235 5.11378 6.89866 5.04605 6.93327 C 4.97832 6.96789 4.92712 7.02796 4.90373 7.10027 C 4.7605 7.60717 4.72722 8.13876 4.8061 8.65954 C 4.36712 7.97446 4.16001 6.97849 4.17732 5.64879 C 4.19644 4.16904 3.04616 3.37699 2.42551 3.16042 C 2.35346 3.12971 1.91419 2.94369 1.34106 2.72941 C 1.15212 2.65897 0.855707 2.19587 0.603898 1.31843 L 2.03534 1.1775 Z"
                                    sx={{
                                        color: "text.secondary", // default color
                                        ".MuiTreeItem-content.Mui-selected &": {
                                            color: "primary.main", // active color
                                        },
                                        ".MuiTreeItem-content:hover &": {
                                            color: "secondary.main", // hover color
                                        },
                                    }}
                                /> */}
                                <Typography>{page.label}</Typography>
                            </Box>
                        }
                    >
                        {page.children.map((subPage) => (
                            <TreeItem key={subPage.id} itemId={subPage.id} label={subPage.label} />
                        ))}
                    </TreeItem>
                ))}
            </SimpleTreeView>
        </div>
    );
}

export default SideBarCategory;
